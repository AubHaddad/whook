[//]: # ( )
[//]: # (This file is automatically generated by a `metapak`)
[//]: # (module. Do not change it  except between the)
[//]: # (`content:start/end` flags, your changes would)
[//]: # (be overridden.)
[//]: # ( )
# whook
> Build strong and efficient REST web services.

[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/nfroidure/whook/blob/master/LICENSE)
[![NPM version](https://badge.fury.io/js/whook.svg)](https://npmjs.org/package/whook)
[![Dependency Status](https://david-dm.org/nfroidure/whook.svg)](https://david-dm.org/nfroidure/whook)
[![devDependency Status](https://david-dm.org/nfroidure/whook/dev-status.svg)](https://david-dm.org/nfroidure/whook#info=devDependencies)
[![Package Quality](http://npm.packagequality.com/shield/whook.svg)](http://packagequality.com/#?package=whook)


[//]: # (::contents:start)

# whook
> Build strong and efficient REST web services.

`whook` allows you to create REST web services by providing
 its ingredients and the recipe to make it work altogether.

The recipe is your Open API definition while ingredients
 are handlers, services and their configuration.

## Principles
Whook work by adding ingredients to you API:
- configuration: Whokk look ups for `config/{NODE_ENV}/config.js` files. It creates
 constants you can inject in your handlers and services.
- API: It defines the various endpoint of you API and how to map these to handlers
 thanks to the well known OpenAPI format (formerly Swagger),
- handlers: the code that implement those endpoints,
- services: various services that deal with global states,
- wrappers: higher order functions you can apply to handlers (CORS, authentication...).

Whook is built over Knifecyle which is great for adding or easily override/wrap
 a lot of its core component. It brings instrumentation and testability to
 your code bases.

Whook also rely on `swagger-http-router` which is a the heart of its routing
 system.

## Work in progress

I'd like to end up with a quick start guide looking like that:
```sh
# Initialize the project
mkdir simple_server && cd simple_server;
npm init whook simple_server;
npm install;

# Check install with a dry run of the server
DRY_RUN=1 npm run start
```

But atm, I only need it for my projects so leaving this as is
 in the meanwhile. If you're still motivated to use it, you
 should take a look to this project's
 [architecture notes](./ARCHITECTURE.md).

[//]: # (::contents:end)

# API
## Functions

<dl>
<dt><a href="#prepareServer">prepareServer(injectedNames, $)</a> ⇒</dt>
<dd><p>Runs the Whook server</p>
</dd>
<dt><a href="#prepareEnvironment">prepareEnvironment($)</a> ⇒</dt>
<dd><p>Prepare the Whook server environment</p>
</dd>
<dt><a href="#initENV">initENV(services, [log])</a> ⇒ <code>Promise.&lt;Object&gt;</code></dt>
<dd><p>Initialize the ENV service using process env plus dotenv files</p>
</dd>
<dt><a href="#initHOST">initHOST(services, [log])</a> ⇒ <code>Promise.&lt;String&gt;</code></dt>
<dd><p>Initialize the HOST service from ENV or auto-detection if
 none specified in ENV</p>
</dd>
<dt><a href="#initPORT">initPORT(services, [log])</a> ⇒ <code>Promise.&lt;Number&gt;</code></dt>
<dd><p>Initialize the PORT service from ENV or auto-detection if
 none specified in ENV</p>
</dd>
<dt><a href="#initProjectDir">initProjectDir(services, [log])</a> ⇒ <code>Promise.&lt;string&gt;</code></dt>
<dd><p>Auto detect the Whook PROJECT_DIR</p>
</dd>
</dl>

<a name="prepareServer"></a>

## prepareServer(injectedNames, $) ⇒
Runs the Whook server

**Kind**: global function  
**Returns**: Object
A promise of the injected services  

| Param | Type | Description |
| --- | --- | --- |
| injectedNames | <code>Array.&lt;String&gt;</code> | Root dependencies names to instanciate and return |
| $ | <code>Knifecycle</code> | The Knifecycle instance to use for the server run |

<a name="prepareEnvironment"></a>

## prepareEnvironment($) ⇒
Prepare the Whook server environment

**Kind**: global function  
**Returns**: Promise<Knifecycle>
A promise of the Knifecycle instance  

| Param | Type | Description |
| --- | --- | --- |
| $ | <code>Knifecycle</code> | The Knifecycle instance to set the various services |

<a name="initENV"></a>

## initENV(services, [log]) ⇒ <code>Promise.&lt;Object&gt;</code>
Initialize the ENV service using process env plus dotenv files

**Kind**: global function  
**Returns**: <code>Promise.&lt;Object&gt;</code> - A promise of an object containing the actual env vars.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services ENV depends on |
| services.NODE_ENV | <code>Object</code> |  | The injected NODE_ENV value to lookk for `.env.${NODE_ENV}` env file |
| services.PWD | <code>Object</code> |  | The process current working directory |
| [services.BASE_ENV] | <code>Object</code> | <code>{}</code> | An optional base environment |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="initHOST"></a>

## initHOST(services, [log]) ⇒ <code>Promise.&lt;String&gt;</code>
Initialize the HOST service from ENV or auto-detection if
 none specified in ENV

**Kind**: global function  
**Returns**: <code>Promise.&lt;String&gt;</code> - A promise of a containing the actual host.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services HOST depends on |
| [services.ENV] | <code>Object</code> | <code>{}</code> | An optional environment object |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="initPORT"></a>

## initPORT(services, [log]) ⇒ <code>Promise.&lt;Number&gt;</code>
Initialize the PORT service from ENV or auto-detection if
 none specified in ENV

**Kind**: global function  
**Returns**: <code>Promise.&lt;Number&gt;</code> - A promise of a number representing the actual port.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services PORT depends on |
| [services.ENV] | <code>Object</code> | <code>{}</code> | An optional environment object |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="initProjectDir"></a>

## initProjectDir(services, [log]) ⇒ <code>Promise.&lt;string&gt;</code>
Auto detect the Whook PROJECT_DIR

**Kind**: global function  
**Returns**: <code>Promise.&lt;string&gt;</code> - A promise of a number representing the actual port.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services PROJECT_DIR depends on |
| services.PWD | <code>Object</code> |  | The process working directory |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |


# Authors
- [Nicolas Froidure](http://insertafter.com/en/index.html)

# License
[MIT](https://github.com/nfroidure/whook/blob/master/LICENSE)
