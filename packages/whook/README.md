[//]: # ( )
[//]: # (This file is automatically generated by a `metapak`)
[//]: # (module. Do not change it  except between the)
[//]: # (`content:start/end` flags, your changes would)
[//]: # (be overridden.)
[//]: # ( )
# @whook/whook
> Build strong and efficient REST web services.

[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/nfroidure/whook/blob/master/packages/whook-whook/LICENSE)
[![NPM version](https://badge.fury.io/js/%40whook%2Fwhook.svg)](https://npmjs.org/package/@whook/whook)


[//]: # (::contents:start)

`whook` allows you to create REST web services by providing
 its ingredients and the recipe to make it work altogether.

The recipe is your Open API definition while ingredients
 are handlers, services and their configuration.

## Principles
Whook work by adding ingredients to you API:
- configuration: Whokk look ups for `config/{NODE_ENV}/config.js` files. It creates
 constants you can inject in your handlers and services.
- API: It defines the various endpoint of you API and how to map these to handlers
 thanks to the well known OpenAPI format (formerly Swagger),
- handlers: the code that implement those endpoints,
- services: various services that deal with global states,
- wrappers: higher order functions you can apply to handlers (CORS, authentication...).

Whook is built over Knifecyle which is great for adding or easily override/wrap
 a lot of its core component. It brings instrumentation and testability to
 your code bases.

[//]: # (::contents:end)

# API
## Members

<dl>
<dt><a href="#default">default</a> ⇒ <code>Promise.&lt;String&gt;</code></dt>
<dd><p>Initialize the API_DEFINITIONS service according to the porject handlers.</p>
</dd>
<dt><a href="#default">default</a> ⇒ <code>Promise.&lt;String&gt;</code></dt>
<dd><p>Initialize the BASE_URL service according to the HOST/PORT
 so that applications fallbacks to that default base URL.</p>
</dd>
<dt><a href="#default">default</a> ⇒ <code>Promise.&lt;Object&gt;</code></dt>
<dd><p>Initialize the CONFIGS service according to the NODE_ENV</p>
</dd>
<dt><a href="#default">default</a> ⇒ <code>Promise.&lt;Number&gt;</code></dt>
<dd><p>Initialize the PORT service from ENV or auto-detection if
 none specified in ENV</p>
</dd>
<dt><a href="#default">default</a> ⇒ <code>Promise.&lt;string&gt;</code></dt>
<dd><p>Auto detect the Whook PROJECT_DIR</p>
</dd>
<dt><a href="#default">default</a> ⇒ <code>Promise.&lt;string&gt;</code></dt>
<dd><p>Auto detect the Whook WHOOK_PLUGINS_PATHS</p>
</dd>
</dl>

## Functions

<dl>
<dt><a href="#prepareServer">prepareServer(injectedNames, $)</a> ⇒</dt>
<dd><p>Runs the Whook server</p>
</dd>
<dt><a href="#prepareEnvironment">prepareEnvironment($)</a> ⇒</dt>
<dd><p>Prepare the Whook server environment</p>
</dd>
<dt><a href="#initENV">initENV(services, [log])</a> ⇒ <code>Promise.&lt;Object&gt;</code></dt>
<dd><p>Initialize the ENV service using process env plus dotenv files</p>
</dd>
<dt><a href="#initHost">initHost(services, [log])</a> ⇒ <code>Promise.&lt;String&gt;</code></dt>
<dd><p>Initialize the HOST service from ENV or auto-detection if
 none specified in ENV</p>
</dd>
</dl>

<a name="default"></a>

## default ⇒ <code>Promise.&lt;String&gt;</code>
Initialize the API_DEFINITIONS service according to the porject handlers.

**Kind**: global variable  
**Returns**: <code>Promise.&lt;String&gt;</code> - A promise of a containing the actual host.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services API_DEFINITIONS depends on |
| services.PROJECT_SRC | <code>Object</code> |  | The project sources location |
| services.WHOOK_PLUGINS_PATHS | <code>Object</code> |  | The plugins paths to load services from |
| [services.IGNORED_FILES_SUFFIXES] | <code>Object</code> |  | The files suffixes the autoloader must ignore |
| [services.IGNORED_FILES_PREFIXES] | <code>Object</code> |  | The files prefixes the autoloader must ignore |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="default"></a>

## default ⇒ <code>Promise.&lt;String&gt;</code>
Initialize the BASE_URL service according to the HOST/PORT
 so that applications fallbacks to that default base URL.

**Kind**: global variable  
**Returns**: <code>Promise.&lt;String&gt;</code> - A promise of a containing the actual host.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services BASE_URL depends on |
| services.ENV | <code>Object</code> |  | The process environment |
| services.CONFIG | <code>Object</code> |  | The injected CONFIG value |
| [services.PROTOCOL] | <code>Object</code> |  | The injected PROTOCOL value |
| services.HOST | <code>Object</code> |  | The injected HOST value |
| services.PORT | <code>Object</code> |  | The injected PORT value |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="default"></a>

## default ⇒ <code>Promise.&lt;Object&gt;</code>
Initialize the CONFIGS service according to the NODE_ENV

**Kind**: global variable  
**Returns**: <code>Promise.&lt;Object&gt;</code> - A promise of a an object the actual configuration properties.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services CONFIGS depends on |
| services.NODE_ENV | <code>Object</code> |  | The injected NODE_ENV value |
| services.PROJECT_SRC | <code>Object</code> |  | The project source directory |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="default"></a>

## default ⇒ <code>Promise.&lt;Number&gt;</code>
Initialize the PORT service from ENV or auto-detection if
 none specified in ENV

**Kind**: global variable  
**Returns**: <code>Promise.&lt;Number&gt;</code> - A promise of a number representing the actual port.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services PORT depends on |
| [services.ENV] | <code>Object</code> | <code>{}</code> | An optional environment object |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="default"></a>

## default ⇒ <code>Promise.&lt;string&gt;</code>
Auto detect the Whook PROJECT_DIR

**Kind**: global variable  
**Returns**: <code>Promise.&lt;string&gt;</code> - A promise of a number representing the actual port.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services PROJECT_DIR depends on |
| services.PWD | <code>Object</code> |  | The process working directory |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="default"></a>

## default ⇒ <code>Promise.&lt;string&gt;</code>
Auto detect the Whook WHOOK_PLUGINS_PATHS

**Kind**: global variable  
**Returns**: <code>Promise.&lt;string&gt;</code> - A promise of a number representing the actual port.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services WHOOK_PLUGINS_PATHS depends on |
| services.WHOOK_PLUGINS | <code>Array.&lt;String&gt;</code> |  | The active whook plugins list |
| services.PROJECT_SRC | <code>String</code> |  | The project source directory |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="prepareServer"></a>

## prepareServer(injectedNames, $) ⇒
Runs the Whook server

**Kind**: global function  
**Returns**: Object
A promise of the injected services  

| Param | Type | Description |
| --- | --- | --- |
| injectedNames | <code>Array.&lt;String&gt;</code> | Root dependencies names to instanciate and return |
| $ | <code>Knifecycle</code> | The Knifecycle instance to use for the server run |

<a name="prepareEnvironment"></a>

## prepareEnvironment($) ⇒
Prepare the Whook server environment

**Kind**: global function  
**Returns**: Promise<Knifecycle>
A promise of the Knifecycle instance  

| Param | Type | Description |
| --- | --- | --- |
| $ | <code>Knifecycle</code> | The Knifecycle instance to set the various services |

<a name="initENV"></a>

## initENV(services, [log]) ⇒ <code>Promise.&lt;Object&gt;</code>
Initialize the ENV service using process env plus dotenv files

**Kind**: global function  
**Returns**: <code>Promise.&lt;Object&gt;</code> - A promise of an object containing the actual env vars.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services ENV depends on |
| services.NODE_ENV | <code>Object</code> |  | The injected NODE_ENV value to look for `.env.${NODE_ENV}` env file |
| services.PWD | <code>Object</code> |  | The process current working directory |
| [services.BASE_ENV] | <code>Object</code> | <code>{}</code> | An optional base environment |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |

<a name="initHost"></a>

## initHost(services, [log]) ⇒ <code>Promise.&lt;String&gt;</code>
Initialize the HOST service from ENV or auto-detection if
 none specified in ENV

**Kind**: global function  
**Returns**: <code>Promise.&lt;String&gt;</code> - A promise of a containing the actual host.  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services HOST depends on |
| [services.ENV] | <code>Object</code> | <code>{}</code> | An optional environment object |
| [log] | <code>Object</code> | <code>noop</code> | An optional logging service |


# Authors
- [Nicolas Froidure](http://insertafter.com/en/index.html)

# License
[MIT](https://github.com/nfroidure/whook/blob/master/packages/whook-whook/LICENSE)
