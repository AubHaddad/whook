[//]: # ( )
[//]: # (This file is automatically generated by a `metapak`)
[//]: # (module. Do not change it  except between the)
[//]: # (`content:start/end` flags, your changes would)
[//]: # (be overridden.)
[//]: # ( )
# @whook/graphql
> GraphQL implementation for Whook servers

[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/nfroidure/whook/blob/master/packages/whook-graphql/LICENSE)
[![NPM version](https://badge.fury.io/js/%40whook%2Fgraphql.svg)](https://npmjs.org/package/@whook/graphql)


[//]: # (::contents:start)

This module uses [Apollo](https://www.apollographql.com/) under the hood
 most of its concepts (modules, plugins...) applies to it.

## Quick setup

Install the module in your project:
```sh
npm i @whook/graphql apollo-server-core
```

Declare the plugin into your `index.ts` file:
```diff
+  import { WhookGraphQLFragmentService } from '@whook/graphql';
+  import { gql } from 'apollo-server-core';
  // (...)

+  // Add the Apollo Server configuration
+  $.register(constant('GRAPHQL_SERVER_OPTIONS', {
+    context: ({ operation, requestContext }) => ({
+      operationId: operation.operationId,
+      authenticationData: requestContext.authenticationData,
+    }),
+  }));

  // Setup your own whook plugins or avoid whook defaults by leaving it empty
-  $.register(constant('WHOOK_PLUGINS', ['@whook/cli', '@whook/whook']));
+  $.register(constant('WHOOK_PLUGINS', ['@whook/graphql', '@whook/cli', '@whook/whook']));

+  // Declare the GraphQL schema fragments
+  const helloFragment: WhookGraphQLFragmentService = {
+    typeDefs: gql`
+      type Query {
+        hello: String
+      }
+      schema {
+        query: Query
+      }
+    `,
+    resolvers: {
+      Query: {
+        hello: () => 'Hello world!',
+      },
+    },
+  };
+
+  $.register(
+    constant('graphQLFragments', [
+      helloFragment,
+    ]),
+  );

  // (...)
```

The GraphQL fragments can be declared into separated services
 for more readability, just create a service to gather them
 all (usually in `src/services/graphQLFragments.ts`):
```ts
import { initializer } from 'knifecycle';

export default initializer(
  {
    name: 'graphQLFragments',
    type: 'service',
    inject: [
      'graphQLUserFragment',
      'graphQLMessageFragment',
    ],
    options: { singleton: true },
  },
  async services => Object.keys(services).map(key => services[key]),
);
```

See [this repository tests](./src/intex.test.ts) for more examples.

[//]: # (::contents:end)

# API
<a name="default"></a>

## default â‡’ <code>Promise</code>
Initialize the GraphQL service

**Kind**: global variable  
**Returns**: <code>Promise</code> - A promise of a GraphQL service  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| services | <code>Object</code> |  | The services the server depends on |
| services.NODE_ENV | <code>Object</code> |  | The injected NODE_ENV value |
| [services.GRAPHQL_SERVER_OPTIONS] | <code>Object</code> \| <code>function</code> |  | The GraphQL options to pass to the server |
| ENV | <code>String</code> |  | The process environment |
| [graphQLFragments] | <code>String</code> |  | Fragments of GraphQL schemas/resolvers declaration |
| [services.log] | <code>function</code> | <code>noop</code> | A logging function |
| [services.time] | <code>function</code> |  | A function returning the current timestamp |


# Authors
- [Nicolas Froidure](http://insertafter.com/en/index.html)

# License
[MIT](https://github.com/nfroidure/whook/blob/master/packages/whook-graphql/LICENSE)
